# Использование KeyCloak для обеспечения безопасности микросервисных приложений 

Keycloak - это открытое программное обеспечение для реализации единой точки аутентификации и авторизации - Single Sign-On.
Для демонстрации некоторых возможностей Keycloak в рамках данного проекта разработаны 3 микросервиса:
 * keycloak-admin-client-app. 
     Предназначен для демонстрации использования keycloak-admin-client. 
	 Содержит методы и Unit-тесты для ручного получения access-token и разбора его содержимого.
 * contract-service-app
     Resource server. Пример backend-сервиса предоставлющего REST ендпоинты для других сервисов или пользователей.
	 Сервис демонстрирует возможности авторизации доступа к своим ресурсам в зависимости от роли запрашиваемого.
 * gate-service-app
     Сервис дополняет демонстрацию возможности авторизации доступа к своим ресурсам.
	 Позволяет отправку на страницу аутентификации пользователя в Keycloak при отсутствии access-токена в http-заголовке

## Локальный запуск сервисов

Для локального запуска сервисов предназначен предварительно настроенный `docker-compose.yml` файл.
yml-файл содержит дерективы для запуска двух контейнеров:
 * Сервер KeyCloak
 * СУБД PostgreSQL (используется сервером KeyCloak, а также микросервисом contract-service-app)

Настроенный `docker-compose.yml` файл расположен в каталоге `docker`.
Достаточно перейти в этот каталог и выполнить команду:
`docker-compose up -d`
Остановка docker-контейнеров:
`docker-compose down`

## Первый запуск docker-compose

При первом запуске docker-compose файла происходит скачивание docker-образов контейнеров KeyCloak и PostgreSQL и их первоначальная настройка.

* PostgreSQL.

Для контейнера PostgreSQL будут созданы две база данных: keycloakdb и contractdb.
Учетные данные для подключения к экземпляру PostgreSQL: `postgres/ postgres`
Порт для подключения к БД: `5432`

* KeyCloak.

## Консоль администрирования KeyCloak

После запуска KeyCloak в docker-контейнере становится доступной [Консоль](http://localhost:8200/auth/) администрирования сервера.

Необходимо войти в консоль его администрирования и импортировать файл настроек KeyCloak: `realm-export.json`
Файл настроек содержит информацию о realm с именем bank необходимую для демонстрации
возможностей KeyCloak сервисами: keycloak-admin-client-app, contract-service-app, gate-service-app.
Импорт необходимо произвести в меню "Add realm" (находится в левом верхнем углу) консоли управления. 
В качестве файла с настройками realm выбрать `realm-export.json`, имя создаваемого realm - bank
Realm с именем bank содержит трех одноименных с сервисами клиента (Clients), а также двух тестовых пользователей: inspector и expert (пароль: 12345678)

Учетные данные администратора: `admin / adminpass`


